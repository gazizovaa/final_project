Â§
    Âseh&)  Ã£                   Ã³Â¦   â€” d dl Zddâ€Zd dlZd dlmZ d dl Zd dl	m
Z
 dd	â€Z
d
â€ Zd dl
Z
d
â€ Zd dlmZ dâ€ Zddâ€Zd dlZdâ€ Zd dlZdâ€ Zd dl	mZmZ dâ€ ZdS )Ã©    NÃ©Ã    Tc                 Ã³Ã”   â€” t           j        Â                     | Â¦  Â«        }t           j        Â                     |Â¦  Â«        }t           j        Â                     |||gÂ¦  Â«        }|r|dz
  S |S )a7  
  Reads in an image from filename, turns it into a tensor and reshapes into
  (224, 224, 3).

  Parameters
  ----------
  filename (str): string filename of target image
  img_shape (int): size to resize target image to, default 224
  scale (bool): whether to scale pixel values to range(0, 1), default True
  g     Ã o@)ÃštfÃšioÃš	read_fileÃšimageÃš
decode_jpegÃšresize)ÃšfilenameÃš	img_shapeÃšscaleÃšimgs       Ãº0D:\div_academy_final_project\helper_functions.pyÃšload_and_prep_imager       s\   â‚¬ Ãµ 	
Å’ÂÅ ËœÃ‘!Ã”!â‚¬#Ã¥
Å’Ã—Ã’ËœSÃ‘!Ã”!â‚¬#Ã¥
Å’ÂÅ ËœËœiÂ¨Ã3Ã‘4Ã”4â‚¬#Ã˜
Ã° Ã 
Ë†tâ€°8â‚¬OÃ 
â‚¬JÃ³    )Ãšconfusion_matrixÂ©Ã©
   r   Ã©   Fc            
      Ã³Â¨  â€” t          | |Â¦  Â«        } | Â                     dÂ¦  Â«        | Â                     dÂ¬Â¦  Â«        ddâ€¦t          j        f         z
  }| j        d         }	t
          j         |Â¬Â¦  Â«        \  }
}
|
Â                     | t          j	        j
        Â¬ Â¦  Â«        }|
Â 
                    |Â¦  Â«         |r|}
nt           j        | j        d         Â¦  Â«        }
|
Â 
                    dd	d
t           j        |	Â¦  Â«        t           j        |	Â¦  Â«        |
|
Â¬
Â¦   Â«          |
j        Â                     dÂ¦  Â«         |
j        Â                     Â¦   Â«          | Â                     Â¦   Â«         | Â                     Â¦   Â«         z   d
z
  }t'          j        t+          | j        d         Â¦  Â«        t+          | j        d         Â¦  Â«        Â¦  Â«        D ]\  }}|rEt
          j        ||| ||f         â€º d|||f         dz  dâ€ºdÂd| ||f         |k    rdnd|Â¬Â¦  Â«         Å’Lt
          j        ||| ||f         â€º d| ||f         |k    rdnd|Â¬Â¦  Â«         Å’â‚¬|r|
Â                     dÂ¦  Â«         dS dS )a  Makes a labelled confusion matrix comparing predictions and ground truth labels.

  If classes is passed, confusion matrix will be labelled, if not, integer class values
  will be used.

  Args:
    y_true: Array of truth labels (must be same shape as y_pred).
    y_pred: Array of predicted labels (must be same shape as y_true).
    classes: Array of class labels (e.g. string form). If `None`, integer labels are used.
    figsize: Size of output figure (default=(10, 10)).
    text_size: Size of output figure text (default=15).
    norm: normalize values or not (default=False).
    savefig: save confusion matrix to file (default=False).
  
  Returns:
    A labelled confusion matrix plot comparing y_true and y_pred.

  Example usage:
    make_confusion_matrix(y_true=test_labels, # ground truth test labels
                          y_pred=y_preds, # predicted labels
                          classes=class_names, # array of class label names
                          figsize=(15, 15),
                          text_size=10)
  ÃšfloatÃ©   Â©ÃšaxisNr   Â©Ãš figsize)ÃšcmapzConfusion MatrixzPredicted labelz
True label) ÃštitleÃšxlabelÃšylabelÃšxticksÃšyticksÃš
xticklabelsÃš
yticklabelsÃšbottomg       @z (Ã©d   z.1fz%)ÃšcenterÃšwhiteÃšblack)ÃšhorizontalalignmentÃšcolorÃšsizezconfusion_matrix.png)r   ÃšastypeÃšsumÃšnpÃš newaxisÃšshapeÃšpltÃšsubplotsÃš matshowÃšcmÃšBluesÃšcolorbarÃšarangeÃšsetÃšxaxisÃšset_label_positionÃš
tick_bottomÃšmaxÃšminÃš	itertoolsÃš productÃšrangeÃštextÃš savefig)Ãšy_trueÃšy_predÃš classesr   Ãš	text_sizeÃšnormrC   r5   Ãš cm_normÃš	n_classesÃšfigÃšaxÃšcaxÃšlabelsÃš	thresholdÃšiÃšjs                    r   Ãšmake_confusion_matrixrR   &   sy  â‚¬ Ãµ4 ËœÂ Ã‘ 'Ã” 'â‚¬"Ã˜ÂIÅ IÂgÃ‘Ã”Â Â§Â¢Â¨QÂ Â¡Â¤Â°Â°Â°Âµ2Â´:Â°
Ã”!>Ã‘>â‚¬'Ã˜Å’hÂqÅ’kâ‚¬)Ãµ 
Å’LÂ Ã)Ã‘)Ã”)Â'â‚¬#â‚¬rÃ˜
Â
Å 
Â2ÂCÅ“FÅ“LË†
Ã‘)Ã”)â‚¬#Ã˜â€¡,â€š,Ë†sÃ‘Ã”ÃÃ° 
Ã° $Ã˜
â‚¬Fâ‚¬FÃ¥
Å’YÂrâ€xÂ â€{Ã‘
#Ã”
#â‚¬FÃ° â€¡&â€š&Ã!Ã˜!Ã˜Ãâ€	Ëœ)Ã‘$Ã”$Ãâ€	Ëœ)Ã‘$Ã”$Ã˜Ã˜Ã°
 	Ã± Ã´ Ã° Ã° â€(Ã—Ã’ËœhÃ‘'Ã”'Ã'Ã˜â€(Ã—Ã’Ã‘Ã”ÃÃ° ÂvÅ vâ€°xÅ’xËœ"Å¸&Å¡&â„¢(Å“(Ã‘"Â bÃ‘(â‚¬)Ãµ Ã”Â¥Â bÂ¤hÂ¨qÂ¤kÃ‘ 2Ã” 2ÂµEÂ¸"Â¼(Ã€1Â¼+Ã‘4FÃ”4FÃ‘GÃ”GÃ° 
Ã° 
Âdâ‚¬aË†Ã˜ 
Ã° 	Ã	â€hË†qÂ!ËœËœ1ËœaËœ4Å“Ã=Ã=Â GÂ¨AÂ¨qÂ¨DÂ¤MÂ°#Ã‘$5Ã=Ã=Ã=Ã=Ã˜"*Ã˜!Â !Â QÂ $Å“xÂ¨)Ã’3Ã3ÂGÂGÂ¸Ã˜Ã°  Ã±  Ã´  Ã°  Ã°  Ãµ
  
â€hË†qÂ!ËœËœ1ËœaËœ4Å“Â]Ã˜"*Ã˜!Â !Â QÂ $Å“xÂ¨)Ã’3Ã3ÂGÂGÂ¸Ã˜Ã°  Ã±  Ã´  Ã°  Ã°  Ã° 
Ã° (Ã˜ â€¡Kâ€šKÃ&Ã‘'Ã”'Ã'Ã'Ã'Ã°(Ã° (r   c                 Ã³Ã‚  â€” t          |Â¦  Â«        }| Â                     t          j        |dÂ¬Â¦  Â«        Â¦  Â«        }t	          |d         Â¦  Â«        dk    r||Â                     Â¦   Â«                  }n3|t
          t          j         |Â¦  Â«        d         d         Â¦  Â«                 }t          j	        |Â¦  Â«         t          j
        d|â€º ÂÂ¦  Â«         t          j
        dÂ¦  Â«         dS ) zâ€“
  Imports an image located at filename, makes a prediction on it with
  a trained model and plots the image with the predicted class as the title.
  r   r   r   zPrediction: FN)r   Ãš predictr   Ãš
expand_dimsÃšlenÃšargmaxÃšintÃšroundr2   Ãšimshowr   r   )Ãšmodelr
   Ãš
class_namesr   ÃšpredÃš
pred_classs         r   Ãš
pred_and_plotr_   q   sÂ»   â‚¬ Ãµ 	ËœHÃ‘%Ã”%â‚¬#Ã° 
ÂÅ â€¢râ€~Â cÂ°Ã2Ã‘2Ã”2Ã‘	3Ã”	3â‚¬$Ãµ 	Ë†Ë†aÅ’Â\â€\ÂAÃ’ÃÃ˜ËœTÅ¸[Å¡[â„¢]Å“]Ã”+â‚¬Jâ‚¬JÃ ÂSÂ¥Â¤Â¨$Â¡Â¤Â°Ã”!2Â°1Ã”!5Ã‘6Ã”6Ã”7â‚¬JÃµ â€*Ë†SÂ/â€/â‚¬/Ãâ€)Ã'Ëœ:Ã'Ã'Ã‘(Ã”(Ã(Ãâ€(Ë†5Â/â€/â‚¬/â‚¬/â‚¬/r   c                 Ã³Ã®   â€” | dz   |z   dz   t           j         Â                     Â¦   Â«         Â                     dÂ¦  Â«        z   }t          j        j        Â                     |Â¬Â¦  Â«        }t          d|â€º ÂÂ¦  Â«         |S )a-  
  Creates a TensorBoard callback instand to store log files.

  Stores log files with the filepath:
    "dir_name/experiment_name/current_datetime/"

  Args:
    dir_name: target directory to store TensorBoard log files
    experiment_name: name of experiment directory (e.g. efficientnet_model_1)
  Ãº/z
%Y%m%d-%H%M%S)Ãš log_dirz!Saving TensorBoard log files to: )ÃšdatetimeÃšnowÃšstrftimer   ÃškerasÃš	callbacksÃš
TensorBoardÃšprint)Ãšdir_nameÃšexperiment_namerb   Ãštensorboard_callbacks       r   Ãšcreate_tensorboard_callbackrm   â€°   s|   â‚¬ Ã° 
Âsâ€°NËœ_Ã‘,Â¨sÃ‘2ÂµXÃ”5FÃ—5JÃ’5JÃ‘5LÃ”5LÃ—5UÃ’5UÃVeÃ‘5fÃ”5fÃ‘fâ‚¬'ÃÅ“Ã”+Ã—7Ã’7Ã˜Ã° 8Ã± Ã´ ÃÃµ Ã5Â¨GÃ5Ã5Ã‘6Ã”6Ã6Ã˜	Ãr   c                 Ã³â€   â€” | j         d         }| j         d         }| j         d         }| j         d         }t          t          | j         d         Â¦  Â«        Â¦  Â«        }t           j        ||dÂ¬Â¦  Â«         t           j        ||dÂ¬Â¦  Â«         t           j        d Â¦  Â«         t           j        dÂ¦  Â«         t           j         Â¦   Â«          t           j        Â¦   Â«          t           j        ||d	Â¬Â¦  Â«         t           j        ||dÂ¬Â¦  Â«         t           j        d
Â¦  Â«         t           j        dÂ¦  Â«         t           j         Â¦   Â«          d
S )zÃŠ
  Returns separate loss curves for training and validation metrics.

  Args:
    history: TensorFlow model History object (see: https://www.tensorflow.org/api_docs/python/tf/keras/callbacks/History)
  ÃšlossÃšval_lossÃšaccuracyÃšval_accuracyÃš
training_lossÂ©ÃšlabelÃšLossÃšEpochsÃštraining_accuracyÃšAccuracyN)	Ãš historyrA   rV   r2   Ãšplotr   r   ÃšlegendÃšfigure)rz   ro   rp   rq   rr   Ãšepochss         r   Ãšplot_loss_curvesr   Å¾   s  â‚¬ Ã° 
Å’ËœÃ”	 â‚¬$Ã˜
Å’_ËœZÃ”
(â‚¬(Ã 
Å’_ËœZÃ”
(â‚¬(Ã˜â€Â Ã”0â‚¬,Ã¥
â€¢ÂWâ€_Â VÃ”,Ã‘-Ã”-Ã‘
.Ã”
.â‚¬&Ãµ â€(Ë†6Â4ËœÃ/Ã‘/Ã”/Ã/Ãâ€(Ë†6Â8Â :Ã.Ã‘.Ã”.Ã.Ãâ€)Ë†FÃ‘Ã”ÃÃâ€*Ë†XÃ‘Ã”ÃÃâ€*Â,â€,â‚¬,Ãµ â€*Â,â€,â‚¬,Ãâ€(Ë†6Â8Ã#6Ã7Ã‘7Ã”7Ã7Ãâ€(Ë†6Â<Â ~Ã6Ã‘6Ã”6Ã6Ãâ€)Ë†JÃ‘Ã”ÃÃâ€*Ë†XÃ‘Ã”ÃÃâ€*Â,â€,â‚¬,â‚¬,â‚¬,r   Ã©   c                 Ã³Ã’  â€” | j         d         }| j         d         }| j         d         }| j         d         }||j         d         z   } ||j         d         z   }||j         d         z   }	||j         d         z   }
t          j        dÂ¬Â¦  Â«         t          j        d ddÂ¦  Â«         t          j        | d	Â¬
Â¦  Â«         t          j        |	d
Â¬
Â¦  Â«         t          j        |dz
  |dz
  gt          j        Â¦   Â«         dÂ¬
Â¦  Â«         t          j        d
Â¬Â¦  Â«         t          j         dÂ¦  Â«         t          j        d dd Â¦  Â«         t          j        |dÂ¬
Â¦  Â«         t          j        |
dÂ¬
Â¦  Â«         t          j        |dz
  |dz
  gt          j        Â¦   Â«         dÂ¬
Â¦  Â«         t          j        dÂ¬Â¦  Â«         t          j         dÂ¦  Â«         t          j        dÂ¦  Â«         t          j	        Â¦   Â«          dS )aP  
    Compares two TensorFlow model History objects.
    
    Args:
      original_history: History object from original model (before new_history)
      new_history: History object from continued model training (after original_history)
      initial_epochs: Number of epochs in original_history (new_history plot starts from here) 
    rq   ro   rr   rp   )Ã©   râ€š   r   Ã©   r   zTraining Accuracyrt   zValidation AccuracyzStart Fine Tuningz
lower right)Ãšlocz Training and Validation Accuracyz
Training LosszValidation Lossz
upper rightzTraining and Validation LossÃšepochN)
rz   r2   r}   Ãš subplotr{   Ãšylimr|   r   r   Ãšshow)
Ãšoriginal_historyÃš
new_historyÃšinitial_epochsÃšaccro   Ãš val_accrp   Ãš	total_accÃš
total_lossÃš
total_val_accÃštotal_val_losss
              r   Ãšcompare_historysrâ€™   Â¼   sÃ©  â‚¬ Ã° 
Ã”
"Â :Ã”
.â‚¬CÃ˜
Ã”
#Â FÃ”
+â‚¬DÃ Ã”&Â ~Ã”6â‚¬GÃ˜Ã”'Â¨
Ã”3â‚¬HÃ° ÂkÃ”)Â¨*Ã”5Ã‘5â‚¬IÃ˜Ëœ
Ã”+Â¨FÃ”3Ã‘3â‚¬JÃ ËœkÃ”1Â°.Ã”AÃ‘Aâ‚¬MÃ˜Â 
Ã” 3Â°JÃ” ?Ã‘?â‚¬NÃµ â€JÂvÃÃ‘Ã”ÃÃ â€KÂÂ1ÂaÃ‘Ã”ÃÃ â€HË†YÃ1Ã2Ã‘2Ã”2Ã2Ã â€HË†]Ã"7Ã8Ã‘8Ã”8Ã8Ã â€HË†nËœQÃ‘Â Â¨qÃ‘ 0Ã
1ÃÅ’hâ€°jÅ’jÃ 3Ã°5Ã± 5Ã´ 5Ã° 5Ã¥ â€JÂ=Ã!Ã‘!Ã”!Ã!Ã â€IÃ0Ã‘1Ã”1Ã1Ã¥ â€KÂÂ1ÂaÃ‘Ã”ÃÃ â€HË†ZËœÃ/Ã‘/Ã”/Ã/Ã â€HË†^Ã#4Ã5Ã‘5Ã”5Ã5Ã â€HË†nËœQÃ‘Â Â¨qÃ‘ 0Ã
1ÃÅ’hâ€°jÅ’jÃ 3Ã°5Ã± 5Ã´ 5Ã° 5Ã¥ â€JÂ=Ã!Ã‘!Ã”!Ã!Ã â€IÃ,Ã‘-Ã”-Ã-Ã â€JË†wÃ‘Ã”ÃÃ â€HÂJâ€Jâ‚¬Jâ‚¬Jâ‚¬Jr   c                 Ã³â‚¬   â€” t          j        | dÂ¦  Â«        }|Â                     Â¦   Â«          |Â                     Â¦   Â«          dS )zË†
  Unzips filename into the current working directory.

  Args:
    filename (str): a filepath to a target zip folder to be unzipped.
  ÃšrN)Ãš zipfileÃš ZipFileÃš
extractallÃšclose)r
   Ãš zip_refs     r   Ãš
unzip_datarÅ¡   Ã¬   s8   â‚¬ Ãµ 
Å’OËœHÂ cÃ‘*Ã”*â‚¬'Ã˜	Ã—Ã’Ã‘Ã”ÃÃ˜	â€¡-â€š-Â/â€/â‚¬/â‚¬/â‚¬/r   c           
      Ã³Â¢   â€” t          j        | Â¦  Â«        D ]9\  }}}t          dt           |Â¦  Â«        â€º dt           |Â¦  Â«        â€º d|â€º dÂ Â¦  Â«         Å’:dS )a  
  Walks through dir_path returning its contents.

  Args:
    dir_path (str): target directory
  
  Returns:
    A print out of:
      number of subdiretories in dir_path
      number of images (files) in each subdirectory
      name of each subdirectory
  z
There are z directories and z images in 'z'.N)ÃšosÃšwalkri   rV   )Ãšdir_pathÃš dirpathÃšdirnamesÃš	filenamess       r   Ãšwalk_through_dirrÂ¢   Ã»   sl   â‚¬ Ãµ ')Â¤gÂ¨hÃ‘&7Ã”&7Ã° `Ã° `Ã‘"â‚¬gË†xËœÃ	Ã
^â€¢sËœ8â€˜}â€}Ã
^Ã
^ÂµsÂ¸9Â±~Â´~Ã
^Ã
^ÃSZÃ
^Ã
^Ã
^Ã‘_Ã”_Ã_Ã_Ã°`Ã° `r   Â©Ãšaccuracy_scoreÃšprecision_recall_fscore_supportc                 Ã³h   â€” t          | |Â¦  Â«        dz  }t          | |dÂ¬Â¦  Â«        \  }}}}||||dÅ“} | S )a  
  Calculates model accuracy, precision, recall and f1 score of a binary classification model.

  Args:
      y_true: true labels in the form of a 1D array
      y_pred: predicted labels in the form of a 1D array

  Returns a dictionary of accuracy, precision, recall, f1-score.
  r&   Ãšweighted)Ãš average)rq   Ãš	precisionÃšrecallÃšf1rÂ£   )rD   rE   Ãšmodel_accuracyÃšmodel_precisionÃšmodel_recallÃšmodel_f1Ãš_Ãš
model_resultss           r   Ãšcalculate_resultsrÂ²     sW   â‚¬ Ãµ "Â &Â¨&Ã‘1Ã”1Â°CÃ‘7â‚¬.Ã¥/NÃˆvÃW]ÃgqÃ/rÃ‘/rÃ”/rÃ‘,â‚¬/Â<Â Â¨1Ã˜-Ã˜.Ã˜(Ã˜ Ã° "Ã° "â‚¬-Ã° 
Ãr   )r   T)Nr   r   FF)râ‚¬   )Ãš
tensorflowr   r   r?   Ãšmatplotlib.pyplotÃšpyplotr2   Ãšnumpyr/   Ãšsklearn.metricsr   rR   r_   rc   rm   r   râ€™   râ€¢   rÅ¡   rÅ“   rÂ¢   rÂ¤   rÂ¥   rÂ²   Â© r   r   Ãº<module>rÂ¹      sJ  Ã°Ã° Ã Ã Ã Ã°Ã° Ã° Ã° Ã°2 Ã Ã Ã Ã˜ Ã Ã Ã Ã Ã Ã˜ Ã Ã Ã Ã˜ ,Ã ,Ã ,Ã ,Ã ,Ã ,Ã°H(Ã° H(Ã° H(Ã° H(Ã°VÃ° Ã° Ã°, â‚¬â‚¬â‚¬Ã°Ã° Ã° Ã°&  Ã Ã Ã Ã Ã Ã°Ã° Ã° Ã°<*Ã° *Ã° *Ã° *Ã°\ â‚¬â‚¬â‚¬Ã°	Ã° 	Ã° 	Ã° 
â‚¬	â‚¬	â‚¬	Ã°`Ã° `Ã° `Ã°" LÃ KÃ KÃ KÃ KÃ KÃ KÃ KÃ°Ã° Ã° Ã° Ã° r   
